<!-- –°—Ç–∏–ª–∏ Markdown –ø–æ–¥–∫–ª—é—á–µ–Ω—ã –∏–∑ app/assets/stylesheets/markdown.css -->

<div class="min-h-screen bg-gray-50 overflow-x-hidden">
  <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
  <nav class="bg-white shadow-sm border-b border-gray-200 sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between h-16">
        <div class="flex items-center">
          <%= link_to freecontent_path, class: "flex items-center gap-3" do %>
            <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
            </svg>
            <span class="text-lg font-bold text-gray-900">–í—Å–µ —É—Ä–æ–∫–∏</span>
          <% end %>
        </div>
        <div class="flex items-center gap-4">
          <%= link_to "–ì–ª–∞–≤–Ω–∞—è", root_path, class: "text-gray-600 hover:text-gray-900" %>
          <%= render partial: "shared/auth_button" %>
        </div>
      </div>
    </div>
  </nav>

  <!-- –•–ª–µ–±–Ω—ã–µ –∫—Ä–æ—à–∫–∏ -->
  <div class="bg-white border-b border-gray-200 overflow-x-auto">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3">
      <div class="flex items-center gap-2 text-xs sm:text-sm text-gray-500 whitespace-nowrap">
        <%= link_to "–ì–ª–∞–≤–Ω–∞—è", root_path, class: "hover:text-green-600" %>
        <span>/</span>
        <%= link_to "–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –∫—É—Ä—Å", freecontent_path, class: "hover:text-green-600" %>
        <span class="hidden sm:inline">/</span>
        <span class="text-gray-900 font-medium truncate max-w-xs hidden sm:inline"><%= @title %></span>
      </div>
    </div>
  </div>

  <!-- –ú–æ–±–∏–ª—å–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —É—Ä–æ–∫–∞–º (—Ç–æ–ª—å–∫–æ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö) -->
  <div class="lg:hidden bg-white border-b border-gray-200">
    <div class="max-w-7xl mx-auto px-4 py-4">
      <details class="group">
        <summary class="flex items-center justify-between cursor-pointer list-none">
          <div class="flex items-center gap-3">
            <span class="text-green-600">üìñ</span>
            <span class="font-bold text-gray-900">–£—Ä–æ–∫ <%= @current_lesson_id.split("-").first %> –∏–∑ 12</span>
          </div>
          <svg class="w-5 h-5 text-gray-500 group-open:rotate-180 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
          </svg>
        </summary>
        <div class="mt-4 space-y-2 max-h-96 overflow-y-auto">
          <% @lessons.each do |lesson| %>
            <%= link_to lesson[:path], class: "flex items-center gap-3 px-3 py-2 rounded-lg #{lesson[:id] == @current_lesson_id ? 'bg-green-500 text-white' : 'bg-gray-50 text-gray-700'}" do %>
              <span class="font-bold text-sm"><%= sprintf("%02d", lesson[:number]) %></span>
              <span class="text-sm flex-grow"><%= lesson[:title] %></span>
            <% end %>
          <% end %>
        </div>
      </details>
    </div>
  </div>

  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 overflow-x-hidden">
    <div class="grid lg:grid-cols-12 gap-6 lg:gap-8">
      <!-- –ë–æ–∫–æ–≤–æ–µ –º–µ–Ω—é (sticky) - —Å–∫—Ä—ã—Ç–æ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö -->
      <aside class="hidden lg:block lg:col-span-3">
        <div class="bg-white rounded-xl shadow-lg p-5 sticky top-24">
          <div class="mb-6 pb-4 border-b-2 border-green-200">
            <h3 class="font-bold text-gray-900 mb-2 text-lg flex items-center gap-2">
              <span class="text-green-600">üìñ</span>
              –ü—Ä–æ–≥—Ä–∞–º–º–∞ –∫—É—Ä—Å–∞
            </h3>
            <div class="text-sm text-gray-500"><%= @lessons.length %> —É—Ä–æ–∫–æ–≤ ‚Ä¢ –ë–µ—Å–ø–ª–∞—Ç–Ω–æ</div>
          </div>
          <nav class="space-y-2">
            <% @lessons.each do |lesson| %>
              <%= link_to lesson[:path], class: "group flex items-start gap-3 px-3 py-3 rounded-lg transition-all #{lesson[:id] == @current_lesson_id ? 'bg-gradient-to-r from-green-500 to-green-600 text-white shadow-md' : 'text-gray-700 hover:bg-green-50 hover:pl-4'}" do %>
                <span class="flex-shrink-0 font-bold <%= lesson[:id] == @current_lesson_id ? 'text-white' : 'text-green-600' %>">
                  <%= sprintf("%02d", lesson[:number]) %>
                </span>
                <span class="text-sm leading-tight flex-grow">
                  <%= lesson[:title] %>
                </span>
                <% if lesson[:id] == @current_lesson_id %>
                  <svg class="w-4 h-4 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                  </svg>
                <% end %>
              <% end %>
            <% end %>
          </nav>

          <!-- CTA –≤ –º–µ–Ω—é -->
          <div class="mt-6 pt-6 border-t border-gray-200">
            <%= link_to root_path, class: "block bg-gradient-to-r from-purple-500 to-pink-500 text-white text-center font-bold py-3 px-4 rounded-lg hover:from-purple-600 hover:to-pink-600 transition-all shadow-lg hover:shadow-xl" do %>
              <div class="text-sm mb-1">üöÄ –ü–æ–ª–Ω—ã–π –∫—É—Ä—Å</div>
              <div class="text-xs text-purple-100">–ì–ª—É–±–æ–∫–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ + –ø–æ–¥–¥–µ—Ä–∂–∫–∞</div>
            <% end %>
          </div>
        </div>
      </aside>

      <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
      <main class="lg:col-span-9 w-full min-w-0">
        <div class="bg-white rounded-xl shadow-lg p-4 sm:p-6 md:p-8 lg:p-12 overflow-x-hidden">
          <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —É—Ä–æ–∫–∞ -->
          <div class="mb-10">
            <div class="flex items-center gap-3 mb-6">
              <div class="inline-block bg-green-100 text-green-700 px-4 py-2 rounded-full text-sm font-bold">
                üìö –£—Ä–æ–∫ <%= @current_lesson_id.split("-").first %>
              </div>
              <div class="flex items-center gap-2 text-gray-500 text-sm">
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/>
                </svg>
                <span>~5 –º–∏–Ω—É—Ç —á—Ç–µ–Ω–∏—è</span>
              </div>
            </div>
            <h1 class="text-2xl sm:text-3xl lg:text-4xl xl:text-5xl font-bold text-gray-900 mb-6 leading-tight break-words">
              <%= @title %>
            </h1>
            <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å –∫—É—Ä—Å–∞ -->
            <div class="bg-gray-100 rounded-full h-2 overflow-hidden">
              <div class="bg-gradient-to-r from-green-500 to-green-600 h-full transition-all" style="width: <%= (@current_lesson_id.split("-").first.to_i.to_f / 12 * 100).round %>%"></div>
            </div>
            <div class="text-sm text-gray-500 mt-2">
              –ü—Ä–æ–≥—Ä–µ—Å—Å –∫—É—Ä—Å–∞: <%= @current_lesson_id.split("-").first %> –∏–∑ 12 —É—Ä–æ–∫–æ–≤
            </div>
          </div>

          <!-- –ö–æ–Ω—Ç–µ–Ω—Ç —É—Ä–æ–∫–∞ (—Ä–∞–∑–º—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ) -->
          <div id="lesson-content-blur" class="transition-all duration-300">
            <!-- –í—Å—Ç—É–ø–∏—Ç–µ–ª—å–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ -->
            <div class="bg-gradient-to-r from-green-50 via-blue-50 to-purple-50 border-2 border-green-200 rounded-2xl p-4 sm:p-6 mb-10">
              <div class="flex items-start gap-4">
                <div class="text-3xl">üéØ</div>
                <div>
                  <h3 class="text-lg font-bold text-gray-900 mb-2">–ß—Ç–æ –≤—ã —É–∑–Ω–∞–µ—Ç–µ –≤ —ç—Ç–æ–º —É—Ä–æ–∫–µ</h3>
                  <p class="text-gray-700">
                    –í —ç—Ç–æ–º —É—Ä–æ–∫–µ –≤—ã –ø–æ–ª—É—á–∏—Ç–µ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–Ω–∞–Ω–∏—è –∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ —Å–º–æ–∂–µ—Ç–µ —Å—Ä–∞–∑—É –ø—Ä–∏–º–µ–Ω–∏—Ç—å –≤ —Å–≤–æ—ë–º –±–∏–∑–Ω–µ—Å–µ.
                  </p>
                </div>
              </div>
            </div>

            <!-- Markdown –∫–æ–Ω—Ç–µ–Ω—Ç -->
            <div class="markdown-content prose-lg max-w-none overflow-x-auto">
              <%= render_markdown(@content) %>
            </div>

            <!-- –ö–ª—é—á–µ–≤—ã–µ –≤—ã–≤–æ–¥—ã (–µ—Å–ª–∏ —ç—Ç–æ –ø–µ—Ä–≤—ã–π —É—Ä–æ–∫) -->
            <% if @current_lesson_id == "01-intro" %>
              <div class="mt-12 bg-gradient-to-r from-yellow-50 to-orange-50 border-2 border-yellow-300 rounded-2xl p-4 sm:p-6 lg:p-8">
                <div class="flex items-start gap-4">
                  <div class="text-4xl">üí°</div>
                  <div>
                    <h3 class="text-2xl font-bold text-gray-900 mb-4">–ö–ª—é—á–µ–≤—ã–µ –≤—ã–≤–æ–¥—ã —ç—Ç–æ–≥–æ —É—Ä–æ–∫–∞</h3>
                    <ul class="space-y-3">
                      <li class="flex items-start gap-3">
                        <span class="text-green-600 font-bold flex-shrink-0">‚úì</span>
                        <span class="text-gray-700">–î–æ—Å—Ç–∞–≤–∫–∞ ‚Äî —ç—Ç–æ —Ä–∞—Å—Ç—É—â–∏–π —Ç—Ä–µ–Ω–¥, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ–ª—å–∑—è –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å</span>
                      </li>
                      <li class="flex items-start gap-3">
                        <span class="text-green-600 font-bold flex-shrink-0">‚úì</span>
                        <span class="text-gray-700">–°–∏—Å—Ç–µ–º–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –≤–∞–∂–Ω–µ–µ —Ä–∞–∑–æ–≤—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π</span>
                      </li>
                      <li class="flex items-start gap-3">
                        <span class="text-green-600 font-bold flex-shrink-0">‚úì</span>
                        <span class="text-gray-700">–ò–∑–±–µ–≥–∞–π—Ç–µ —Ç–∏–ø–∏—á–Ω—ã—Ö –æ—à–∏–±–æ–∫ –Ω–æ–≤–∏—á–∫–æ–≤ —Å –ø–µ—Ä–≤–æ–≥–æ –¥–Ω—è</span>
                      </li>
                    </ul>
                  </div>
                </div>
              </div>
            <% end %>
          </div>

          <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è –º–µ–∂–¥—É —É—Ä–æ–∫–∞–º–∏ -->
          <div class="mt-12 pt-8 border-t border-gray-200">
            <div class="flex flex-col sm:flex-row items-stretch sm:items-center justify-between gap-4">
              <% if @prev_lesson %>
                <% prev_classes = "flex items-center gap-3 text-gray-600 hover:text-green-600 transition-colors group w-full sm:w-auto" %>
                <%= link_to @prev_lesson[:path], class: prev_classes do %>
                  <div class="flex items-center justify-center w-10 h-10 bg-gray-100 group-hover:bg-green-100 rounded-full transition-colors flex-shrink-0">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                    </svg>
                  </div>
                  <div class="min-w-0">
                    <div class="text-xs sm:text-sm text-gray-500">–ü—Ä–µ–¥—ã–¥—É—â–∏–π —É—Ä–æ–∫</div>
                    <div class="font-medium text-sm sm:text-base truncate"><%= @prev_lesson[:title] %></div>
                  </div>
                <% end %>
              <% else %>
                <div class="hidden sm:block"></div>
              <% end %>

              <% if @next_lesson %>
                <% next_classes = "flex items-center gap-3 text-gray-600 hover:text-green-600 transition-colors group w-full sm:w-auto sm:text-right" %>
                <%= link_to @next_lesson[:path], class: next_classes do %>
                  <div class="min-w-0 flex-grow sm:order-1">
                    <div class="text-xs sm:text-sm text-gray-500">–°–ª–µ–¥—É—é—â–∏–π —É—Ä–æ–∫</div>
                    <div class="font-medium text-sm sm:text-base truncate"><%= @next_lesson[:title] %></div>
                  </div>
                  <div class="flex items-center justify-center w-10 h-10 bg-green-500 group-hover:bg-green-600 rounded-full transition-colors flex-shrink-0 sm:order-2">
                    <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                    </svg>
                  </div>
                <% end %>
              <% else %>
                <!-- –ï—Å–ª–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–π —É—Ä–æ–∫ - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º CTA -->
                <% cta_classes = "flex items-center justify-center gap-3 bg-gradient-to-r from-green-500 to-green-600 text-white px-6 py-4 rounded-lg hover:from-green-600 hover:to-green-700 transition-all shadow-lg w-full sm:w-auto" %>
                <%= link_to root_path, class: cta_classes do %>
                  <span class="font-bold text-base sm:text-lg">–ü–µ—Ä–µ–π—Ç–∏ –∫ –ø–æ–ª–Ω–æ–º—É –∫—É—Ä—Å—É</span>
                  <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z" clip-rule="evenodd"/>
                  </svg>
                <% end %>
              <% end %>
            </div>
          </div>

          <!-- Feedback —Å–µ–∫—Ü–∏—è -->
          <div class="mt-8 bg-gray-50 rounded-xl p-6">
            <div class="text-center">
              <h3 class="text-lg font-bold text-gray-900 mb-2">–ë—ã–ª –ª–∏ —ç—Ç–æ—Ç —É—Ä–æ–∫ –ø–æ–ª–µ–∑–µ–Ω?</h3>
              <p class="text-gray-600 mb-4 text-sm">
                –ü–æ–¥–µ–ª–∏—Ç–µ—Å—å –≤–∞—à–∏–º –º–Ω–µ–Ω–∏–µ–º ‚Äî —ç—Ç–æ –ø–æ–º–æ–∂–µ—Ç –Ω–∞–º —É–ª—É—á—à–∞—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç
              </p>
              <div class="flex justify-center gap-4">
                <button class="px-6 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg transition-colors">
                  üëç –ü–æ–ª–µ–∑–Ω–æ
                </button>
                <button class="px-6 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg transition-colors">
                  üëé –ù–µ –æ—á–µ–Ω—å
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- CTA –±–∞–Ω–Ω–µ—Ä –ø–æ–¥ –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º -->
        <div class="mt-8 bg-gradient-to-r from-blue-500 to-purple-600 rounded-xl p-6 md:p-8 text-white shadow-xl">
          <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4">
            <div class="flex-grow">
              <h3 class="text-xl sm:text-2xl font-bold mb-2">–•–æ—Ç–∏—Ç–µ –±–æ–ª—å—à–µ?</h3>
              <p class="text-sm sm:text-base text-blue-50">
                –ü–æ–ª–Ω—ã–π –∫—É—Ä—Å –≤–∫–ª—é—á–∞–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏, –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä—ã, –∂–∏–≤—ã–µ —Å–µ—Å—Å–∏–∏ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫—É 24/7
              </p>
            </div>
            <% cta_btn_classes = "bg-white text-purple-600 font-bold px-6 sm:px-8 py-3 rounded-lg hover:bg-gray-100 transition-colors whitespace-nowrap" %>
            <%= link_to "–£–∑–Ω–∞—Ç—å –±–æ–ª—å—à–µ ‚Üí", root_path, class: cta_btn_classes %>
          </div>
        </div>
      </main>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ -->
  <div id="auth-modal" class="hidden fixed inset-0 bg-black/30 z-50 flex items-center justify-center p-4">
    <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full p-8 relative">
      <button onclick="window.location.href='/freecontent'" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
        </svg>
      </button>

      <div class="text-center">
        <div class="mb-6">
          <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
            <svg class="w-12 h-12 text-green-600" fill="currentColor" viewBox="0 0 24 24">
              <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
            </svg>
          </div>
          <h2 class="text-3xl font-bold text-gray-900 mb-3">–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</h2>
          <p class="text-gray-600 mb-6">
            –ß—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ —ç—Ç–æ–º—É —É—Ä–æ–∫—É, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –∞–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å —á–µ—Ä–µ–∑ Telegram
          </p>
        </div>

        <button onclick="document.getElementById('auth-button').click(); hideAuthModal()" class="w-full bg-gradient-to-r from-green-500 to-green-600 text-white font-bold py-4 px-8 rounded-lg hover:from-green-600 hover:to-green-700 transition-all shadow-lg hover:shadow-xl mb-4">
          <span class="flex items-center justify-center gap-2">
            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
              <path d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm5.894 8.221l-1.97 9.28c-.145.658-.537.818-1.084.508l-3-2.21-1.446 1.394c-.14.18-.357.295-.6.295-.002 0-.003 0-.005 0l.213-3.054 5.56-5.022c.24-.213-.054-.334-.373-.121l-6.869 4.326-2.96-.924c-.64-.203-.658-.64.135-.954l11.566-4.458c.538-.196 1.006.128.832.941z"/>
            </svg>
            –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ Telegram
          </span>
        </button>

        <p class="text-sm text-gray-500">
          –≠—Ç–æ –±—ã—Å—Ç—Ä–æ, –±–µ–∑–æ–ø–∞—Å–Ω–æ –∏ –∑–∞–π–º–µ—Ç –≤—Å–µ–≥–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥
        </p>
      </div>
    </div>
  </div>
</div>

<%= render partial: "shared/auth_script" %>
