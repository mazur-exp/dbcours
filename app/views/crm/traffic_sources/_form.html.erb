<%= form_with(model: traffic_source, class: "space-y-6") do |form| %>
  <% if traffic_source.errors.any? %>
    <div class="bg-red-50 border border-red-200 rounded-lg p-4">
      <h3 class="text-red-800 font-semibold">–û—à–∏–±–∫–∏:</h3>
      <ul class="mt-2 text-sm text-red-700 list-disc list-inside">
        <% traffic_source.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="bg-white rounded-lg shadow p-6 space-y-6">
    <!-- –ù–∞–∑–≤–∞–Ω–∏–µ -->
    <div>
      <%= form.label :name, "–ù–∞–∑–≤–∞–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞", class: "block text-sm font-medium text-gray-700 mb-2" %>
      <%= form.text_field :name, placeholder: "YouTube –≤–∏–¥–µ–æ #1", class: "w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" %>
    </div>

    <!-- –í—ã–±–æ—Ä –ø—Ä–æ–¥—É–∫—Ç–∞ -->
    <div>
      <%= form.label :product, "–ü—Ä–æ–¥—É–∫—Ç", class: "block text-sm font-medium text-gray-700 mb-2" %>
      <%= form.select :product,
          TrafficSource::PRODUCT_CONFIG.map { |key, config| ["#{config[:emoji]} #{config[:name]}", key] },
          {},
          class: "w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500" %>
      <p class="mt-1 text-xs text-gray-500">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–¥—É–∫—Ç, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–π –≤–µ–¥—ë—Ç —Å—Å—ã–ª–∫–∞</p>
    </div>

    <!-- –¢–∏–ø —Å—Å—ã–ª–∫–∏ -->
    <div>
      <%= form.label :link_type, "–¢–∏–ø —Å—Å—ã–ª–∫–∏", class: "block text-sm font-medium text-gray-700 mb-2" %>
      <%= form.select :link_type, [['üåê –°—Å—ã–ª–∫–∞ –Ω–∞ —Å–∞–π—Ç', 'site'], ['ü§ñ –°—Å—ã–ª–∫–∞ –Ω–∞ –±–æ—Ç', 'bot']], {}, class: "w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500" %>
    </div>

    <!-- UTM –ø–∞—Ä–∞–º–µ—Ç—Ä—ã -->
    <div class="border-t pt-6">
      <h3 class="text-lg font-semibold text-gray-900 mb-4">UTM –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</h3>

      <div class="space-y-4">
        <div>
          <%= form.label :utm_source, "UTM Source (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)", class: "block text-sm font-medium text-gray-700 mb-2" %>
          <%= form.text_field :utm_source, placeholder: "youtube", class: "w-full px-4 py-2 border border-gray-300 rounded-lg" %>
        </div>

        <div>
          <%= form.label :utm_medium, "UTM Medium", class: "block text-sm font-medium text-gray-700 mb-2" %>
          <%= form.text_field :utm_medium, placeholder: "video", class: "w-full px-4 py-2 border border-gray-300 rounded-lg" %>
        </div>

        <div>
          <%= form.label :utm_campaign, "UTM Campaign", class: "block text-sm font-medium text-gray-700 mb-2" %>
          <%= form.text_field :utm_campaign, placeholder: "promo_january", class: "w-full px-4 py-2 border border-gray-300 rounded-lg" %>
        </div>
      </div>
    </div>

    <!-- –¶–µ–ª–µ–≤–æ–π URL (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –¥–ª—è —Å–∞–π—Ç–∞) -->
    <div>
      <%= form.label :target_url, "–¶–µ–ª–µ–≤–æ–π URL (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)", class: "block text-sm font-medium text-gray-700 mb-2" %>
      <%= form.text_field :target_url, placeholder: "https://course.aidelivery.tech", class: "w-full px-4 py-2 border border-gray-300 rounded-lg" %>
      <p class="mt-1 text-xs text-gray-500">–ï—Å–ª–∏ –ø—É—Å—Ç–æ - —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É</p>
    </div>

    <!-- –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä -->
    <% if traffic_source.persisted? %>
      <div class="bg-green-50 border border-green-200 rounded-lg p-4">
        <h4 class="font-semibold text-green-900 mb-2">–ö–æ—Ä–æ—Ç–∫–∞—è —Å—Å—ã–ª–∫–∞:</h4>
        <div class="flex items-center gap-2">
          <code class="flex-1 bg-white px-3 py-2 rounded border text-sm"><%= traffic_source.short_url %></code>
          <button type="button" onclick="navigator.clipboard.writeText('<%= traffic_source.short_url %>')" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded">
            üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
          </button>
        </div>
      </div>
    <% end %>

    <!-- –ö–Ω–æ–ø–∫–∏ -->
    <div class="flex items-center gap-4">
      <%= form.submit traffic_source.persisted? ? "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å" : "–°–æ–∑–¥–∞—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫", class: "bg-green-500 hover:bg-green-600 text-white font-semibold py-3 px-6 rounded-lg transition-colors" %>
      <%= link_to "–û—Ç–º–µ–Ω–∞", crm_traffic_sources_path, class: "text-gray-600 hover:text-gray-900" %>
    </div>
  </div>
<% end %>
