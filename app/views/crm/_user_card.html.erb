<%
  # Ğ¦Ğ²ĞµÑ‚ Ğ±ĞµĞ¹Ğ´Ğ¶Ğ° Ğ´Ğ»Ñ ai_ready_score
  score_colors = {
    (8..10) => 'bg-red-500 text-white',
    (6..7) => 'bg-orange-500 text-white',
    (4..5) => 'bg-yellow-500 text-white',
    (1..3) => 'bg-blue-500 text-white'
  }

  score = user.ready_score
  score_color = score ? (score_colors.find { |range, _| range.include?(score) }&.last || 'bg-gray-400 text-white') : 'bg-gray-400 text-white'
%>

<div id="user_card_<%= user.id %>"
     class="kanban-card bg-white rounded-lg shadow-sm hover:shadow-lg transition-all duration-200 border border-gray-200 p-3 active:opacity-50 active:shadow-2xl select-none cursor-grab hover:cursor-pointer"
     data-kanban-target="card"
     data-user-id="<%= user.id %>"
     data-conversation-id="<%= user.conversation&.id %>"
     data-ready-score="<%= user.ready_score || 0 %>"
     data-position="<%= user.crm_position || 999 %>"
     draggable="true"
     data-action="dragstart->kanban#handleDragStart dragend->kanban#handleDragEnd click->kanban#openMessenger">

  <!-- Ğ—Ğ°Ğ³Ğ¾Ğ»Ğ¾Ğ²Ğ¾Ğº ĞºĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞºĞ¸ -->
  <div class="flex items-start gap-3 mb-3">
    <!-- ĞĞ²Ğ°Ñ‚Ğ°Ñ€ -->
    <div class="flex-shrink-0">
      <%= user_avatar(user, 'rounded-full', 'w-10 h-10') %>
    </div>

    <!-- Ğ˜Ğ¼Ñ Ğ¸ Ğ¸Ğ½Ñ„Ğ¾ -->
    <div class="flex-1 min-w-0">
      <h4 class="font-semibold text-gray-900 text-sm truncate">
        <%= user.full_name %>
      </h4>
      <% if user.username %>
        <p class="text-xs text-gray-500 truncate">@<%= user.username %></p>
      <% end %>
    </div>

    <!-- Ğ¢ĞµĞ¼Ğ¿ĞµÑ€Ğ°Ñ‚ÑƒÑ€Ğ° Ğ»Ğ¸Ğ´Ğ° -->
    <div class="flex-shrink-0 text-xl" title="<%= user.lead_temperature %>">
      <%= user.temperature_emoji %>
    </div>
  </div>

  <!-- ĞœĞµÑ‚Ñ€Ğ¸ĞºĞ¸ -->
  <div class="grid grid-cols-2 gap-2 mb-3">
    <!-- AI Ready Score -->
    <div class="flex items-center gap-1">
      <span class="text-xs text-gray-500">Score:</span>
      <% if score %>
        <span class="<%= score_color %> text-xs font-bold px-2 py-0.5 rounded-full">
          <%= score %>/10
        </span>
      <% else %>
        <span class="text-xs text-gray-400">â€”</span>
      <% end %>
    </div>

    <!-- Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ -->
    <div class="flex items-center gap-1">
      <span class="text-xs text-gray-500">ğŸ’¬</span>
      <span class="text-xs font-semibold text-gray-700">
        <%= user.messages_count %>
      </span>
    </div>
  </div>

  <!-- Ğ”Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ°Ñ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ -->
  <div class="border-t border-gray-100 pt-2 space-y-1">
    <% if user.conversation&.ai_real_name.present? %>
      <div class="flex items-center gap-1 text-xs">
        <span class="text-gray-500">Ğ˜Ğ¼Ñ:</span>
        <span class="font-medium text-gray-700 truncate"><%= user.conversation.ai_real_name %></span>
      </div>
    <% end %>

    <% if user.conversation&.last_message_at %>
      <div class="flex items-center gap-1 text-xs text-gray-500">
        <span>ğŸ•</span>
        <span><%= time_ago_in_words(user.conversation.last_message_at) %> Ğ½Ğ°Ğ·Ğ°Ğ´</span>
      </div>
    <% end %>

    <% if user.paid? %>
      <div class="flex items-center gap-1 text-xs">
        <span class="bg-green-100 text-green-800 font-semibold px-2 py-0.5 rounded-full">
          ğŸ’° ĞĞ¿Ğ»Ğ°Ñ‡ĞµĞ½Ğ¾
        </span>
      </div>
    <% end %>
  </div>

</div>
