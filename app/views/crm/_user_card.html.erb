<%
  # –¶–≤–µ—Ç –±–µ–π–¥–∂–∞ –¥–ª—è ai_ready_score
  score_colors = {
    (8..10) => 'bg-red-500 text-white',
    (6..7) => 'bg-orange-500 text-white',
    (4..5) => 'bg-yellow-500 text-white',
    (1..3) => 'bg-blue-500 text-white'
  }

  score = user.ready_score
  score_color = score ? (score_colors.find { |range, _| range.include?(score) }&.last || 'bg-gray-400 text-white') : 'bg-gray-400 text-white'
%>

<div id="user_card_<%= user.id %>"
     class="kanban-card bg-white rounded-lg shadow-sm hover:shadow-lg transition-all duration-200 border border-gray-200 p-3 active:opacity-50 active:shadow-2xl select-none cursor-grab hover:cursor-pointer"
     data-kanban-target="card"
     data-user-id="<%= user.id %>"
     data-conversation-id="<%= user.conversation&.id %>"
     data-ready-score="<%= user.ready_score || 0 %>"
     data-position="<%= user.crm_position || 999 %>"
     draggable="true"
     data-action="dragstart->kanban#handleDragStart dragend->kanban#handleDragEnd click->kanban#openMessenger">

  <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∫–∞—Ä—Ç–æ—á–∫–∏ -->
  <div class="flex items-start gap-3 mb-3">
    <!-- –ê–≤–∞—Ç–∞—Ä -->
    <div class="flex-shrink-0">
      <%= user_avatar(user, 'rounded-full', 'w-10 h-10') %>
    </div>

    <!-- –ò–º—è –∏ –∏–Ω—Ñ–æ -->
    <div class="flex-1 min-w-0">
      <h4 class="font-semibold text-gray-900 text-sm truncate">
        <%= user.full_name %>
      </h4>
      <% if user.username %>
        <p class="text-xs text-gray-500 truncate">@<%= user.username %></p>
      <% end %>
    </div>

    <!-- –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –ª–∏–¥–∞ -->
    <div class="flex-shrink-0 text-xl" title="<%= user.lead_temperature %>">
      <%= user.temperature_emoji %>
    </div>
  </div>

  <!-- –ú–µ—Ç—Ä–∏–∫–∏ -->
  <div class="grid grid-cols-2 gap-2 mb-3">
    <!-- AI Ready Score -->
    <div class="flex items-center gap-1">
      <span class="text-xs text-gray-500">Score:</span>
      <% if score %>
        <span class="<%= score_color %> text-xs font-bold px-2 py-0.5 rounded-full">
          <%= score %>/10
        </span>
      <% else %>
        <span class="text-xs text-gray-400">‚Äî</span>
      <% end %>
    </div>

    <!-- –°–æ–æ–±—â–µ–Ω–∏—è -->
    <div class="flex items-center gap-1">
      <span class="text-xs text-gray-500">üí¨</span>
      <span class="text-xs font-semibold text-gray-700">
        <%= user.messages_count %>
      </span>
    </div>
  </div>

  <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
  <div class="border-t border-gray-100 pt-2 space-y-1">
    <% if user.traffic_source %>
      <div class="flex items-center gap-1 text-xs">
        <span class="text-gray-500">–ò—Å—Ç–æ—á–Ω–∏–∫:</span>
        <span class="bg-indigo-100 text-indigo-800 px-2 py-0.5 rounded-full font-semibold truncate">
          <%= user.traffic_source.site? ? 'üåê' : 'ü§ñ' %> <%= user.traffic_source.name %>
        </span>
      </div>
    <% end %>

    <% if user.conversation&.ai_real_name.present? %>
      <div class="flex items-center gap-1 text-xs">
        <span class="text-gray-500">–ò–º—è:</span>
        <span class="font-medium text-gray-700 truncate"><%= user.conversation.ai_real_name %></span>
      </div>
    <% end %>

    <% if user.conversation&.last_message_at %>
      <div class="flex items-center gap-1 text-xs text-gray-500">
        <span>üïê</span>
        <span><%= time_ago_in_words(user.conversation.last_message_at) %> –Ω–∞–∑–∞–¥</span>
      </div>
    <% end %>

    <% if user.paid? %>
      <div class="flex items-center gap-1 text-xs">
        <span class="bg-green-100 text-green-800 font-semibold px-2 py-0.5 rounded-full">
          üí∞ –û–ø–ª–∞—á–µ–Ω–æ
        </span>
      </div>
    <% end %>
  </div>

</div>
